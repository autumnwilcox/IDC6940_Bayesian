---
title: "Bayesian Logistic Regression Application in Diabetes Probability Prediction"
subtitle: "IDC6940 Fall 2025 Capstone Project Presentation"
author: "Namita Mishra, Autumn Wilcox (Advisor: Dr. Cohen)"
date: '`r Sys.Date()`'
format:
  revealjs:
    theme: simple
    slide-number: true
    chalkboard: false
    transition: slide
course: Capstone Projects in Data Science
bibliography: references.bib
self-contained: true
execute:
  warning: false
  message: false
  echo: false
editor:
  markdown:
    wrap: 72
---

## Our Question

- Can Bayesian logistic regression provide **more stable** and **transparent** inference than classical MLE for diabetes-related outcomes in **NHANES 2013–2014**?
- Focus predictors: **BMI category (BMDBMIC)**, **Age (RIDAGEYR)**, **Sex (RIAGENDR)**, **Race/Ethnicity (RIDRETH1)**  
- Outcome (for now): **DIQ240** (usual diabetes doctor) — diabetes-related; we may swap to **DIQ010** (diagnosis) in the next iteration and keep DIQ240 as a covariate.

---

## Data Pipeline (Reproducible)

- Source: NHANES 2013–2014  
- Files: **BMX_H**, **DEMO_H**, **DIQ_H**  
- Preprocessing is in **`R/data_prep.R`** (team runs once)
- Analysis slides **load** prebuilt data:

```{r}
# Build if missing, then load
if (!file.exists("data/merged_2013_2014.rds")) {
  source("R/data_prep.R")
}
merged_data <- readRDS("data/merged_2013_2014.rds")
```

---

## Variables (Kept to Match Team Script)

**Predictors/Covariates:**
- BMDBMIC (BMI category), RIDAGEYR (Age), RIAGENDR (Sex), RIDRETH1 (Race/Ethnicity)

**Survey Design:**
- WTMEC2YR (weights), SDMVPSU (PSU), SDMVSTRA (strata)

**Outcome (current placeholder):**
- DIQ240 — not a diagnosis; proxy for diabetes care.
- **Plan:** consider DIQ010 as outcome; keep DIQ240 as access/behavior covariate.

---

## Quick EDA: Age Distribution 

```{r}
library(tidyverse)
library(knitr)

# Peek
knitr::kable(head(merged_data))

# Plot
ggplot(merged_data, aes(x = RIDAGEYR)) +
  geom_histogram(binwidth = 5, boundary = 0, closed = "left") +
  labs(title = "Age Distribution (NHANES 2013–2014)",
       x = "Age (years)", y = "Count") +
  theme_minimal()
```

## Quick EDA: BMI Category Codes

```{r}
merged_data %>%
  mutate(BMDBMIC = factor(BMDBMIC, exclude = NULL)) %>%
  count(BMDBMIC) %>%
  ggplot(aes(x = BMDBMIC, y = n)) +
  geom_col() +
  labs(title = "Counts by BMDBMIC (BMI Category Code)",
       x = "BMDBMIC (code; NA common for adults)", y = "Count") +
  theme_minimal()
```

## Survey Design

```{r}
library(survey)
nhanes_design <- svydesign(
  id = ~SDMVPSU,
  strata = ~SDMVSTRA,
  weights = ~WTMEC2YR,
  nest = TRUE,
  data = merged_data
)
svymean(~RIDAGEYR, nhanes_design, na.rm = TRUE)
```

## Methods (Plan)

- **Baseline:** Logistic regression (MLE)
- **Main:** Bayesian logistic regression with weakly-informative priors
- **Missingness:** Prefer multiple imputation (or Bayesian missing-data modeling) over listwise deletion to avoid instability/separation
- **Compare:** effect estimates (ORs / posteriors), uncertainty (CIs vs credible intervals), calibration and discrimination

---

## Modeling

```{r}
# library(rstanarm)  # or library(brms)

# Example formulas (uncomment after outcome finalized):
# fit_mle <- glm(outcome ~ BMDBMIC + RIDAGEYR + RIAGENDR + RIDRETH1 + DIQ240,
#                data = merged_data, family = binomial())

# fit_bayes <- rstanarm::stan_glm(
#   outcome ~ BMDBMIC + RIDAGEYR + RIAGENDR + RIDRETH1 + DIQ240,
#   data = merged_data, family = binomial(),
#   prior = rstanarm::normal(0, 2.5),
#   prior_intercept = rstanarm::normal(0, 5),
#   chains = 4, iter = 2000, seed = 123
# )
```

## What to Expect in Results

- **Stability:** Priors shrink unstable MLE estimates under separation
- **Uncertainty:** Posteriors provide full credible intervals
- **Practicality:** Survey-aware modeling reflects population inference
- **Sensitivity:** Check priors; compare MI vs. deletion

---

## Next Steps

- Finalize outcome (DIQ010 likely) and keep DIQ240 as covariate
- Implement MI (document MAR/MNAR assumptions)
- Fit MLE and Bayesian models; add survey-weighted variants
- Report effects, uncertainty, and predictive performance

---

## References
See references.bib. (Key: survey methods, Bayesian GLMs, imputation.)