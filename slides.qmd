---
title: "Bayesian Logistic Regression for Predicting Diabetes Risk"
subtitle: |
  NHANES 2013–2014 Analysis  
  
  **Namita Mishra & Autumn Wilcox**\ 
  December 13, 2025
format:
  revealjs:
    theme: simple
    slide-number: true
    transition: fade
    incremental: false
    scrollable: true
    toc: false
    code-overflow: wrap
    code-line-numbers: false
    css: styles.css
execute:
  echo: true
  warning: false
  message: false
  eval: false
bibliography: references.bib
editor: visual
---

## Introduction & Aims

::: panel-tabset

### Introduction

* Diabetes is a major public health issue.
* Classical logistic regression can become unstable with missing data or separation issues.
* Bayesian logistic regression improves stability by incorporating prior information and providing stronger uncertainty estimates.
* This project evaluates whether Bayesian methods offer more reliable and interpretable diabetes risk estimates than traditional approaches.

### Aims

* Apply Bayesian logistic regression to predict diabetes status.
* Examine associations between diabetes and BMI, age (≥20), sex, and race.
* Use NHANES 2013–2014 data accounting for complex survey design.
* Address challenges such as missing data, complete case bias, and data separation.

:::

---

## Bayesian Logistic Regression

::: panel-tabset

### Overview

* Integrates prior knowledge with observed data to form posterior distributions.
* Parameters represented as random variables with full probability distributions.
* Produces credible intervals and direct probabilistic interpretations.

### Model Structure

* Logistic model uses predictors to estimate log-odds of a binary outcome.
* Priors assigned to parameters; posterior obtained via Bayes' theorem.
* Posterior reflects updated beliefs after observing data.

### Prior Specification

* Weakly informative priors stabilize estimation.
* **Coefficients**: Normal(0, 2.5).
* **Intercept**: Student t(3, 0, 10).

:::

---

## Model Evaluation & Diagnostics

::: panel-tabset

### Convergence Checks

Assessed using NUTS, R-hat, ESS, autocorrelation.

### Model Fit

* Posterior predictive checks.
* Bayesian R² (~0.13) — reflects variance explained on the latent scale and is typical for logistic models using population health data.

:::

---

## Data Preparation

::: panel-tabset

### Overview

* Uses NHANES 2013–2014 public data (DEMO_H, BMX_H, DIQ_H).
* Files imported in .XPT format using haven in R.
* Merged using SEQN to create an adult dataset (age ≥ 20).
* Standardized variable types before merging.
* Ensured consistent numeric/factor formatting for modeling.

### Import & Merge

* Data loaded and combined using tidyverse + base R.
* SEQN used as the unique key to preserve record linkage.
* Merged dataset includes demographics, body measures, and diabetes answers.
* Adults (≥20) retained for the analytic cohort.
* Missing BMI and some demographic predictors handled later via MICE.
  *Outcome (diabetes_dx) was not imputed.*

### Variable Definitions

* **Response Variable:** diabetes_dx (binary), derived from DIQ010.
* **Survey Design Variables:** WTMEC2YR, SDMVPSU, SDMVSTRA.
* **Derived Variables:** age_c, bmi_c.

:::

---

## Study Design Overview

::: {style="font-size: 0.75em"}
::: panel-tabset

### NHANES Design

* Multistage probability sampling with stratification, clustering, oversampling.
* Nationally representative U.S. adult estimates.
* **Key Design Variables:** SDMVPSU, SDMVSTRA, WTMEC2YR.

### Why Weighting Matters

* Adjusts for unequal selection probability and nonresponse.
* Provides unbiased prevalence estimates.
* Ensures valid standard errors for population inference.

:::
:::

---

## Building the Analytic Cohort

::: {style="font-size: 0.75em"}
::: panel-tabset

### Data Workflow

* Imported DEMO_H, BMX_H, DIQ_H (.XPT) using haven.
* Merged using SEQN; restricted to adults ≥20.
* Standardized variable formats before merging.

### Adult Cohort

* **Final Analytic Sample:** 5,769 adults.
* Includes demographics, BMI, diabetes status, survey design vars.
* **Predictors:** age, BMI, sex, race.

:::
:::

---

## Missingness & Data Quality

::: {style="font-size: 0.75em"}
::: panel-tabset

### Missingness Overview

* Missing mainly in BMI (~4.3%).
* Diabetes diagnosis variable (diabetes_dx) has ~3% missing, but those observations were excluded before MICE.
* Demographics and survey design variables fully observed.
* Pattern consistent with MAR; suitable for imputation.

### Missingness Visualization

![](figs/missingness.png){fig-align="center" width="70%"}

:::
:::

---

## Exploratory Data Analysis (EDA)

::: {style="font-size: 0.75em"}
::: panel-tabset

### Outcome Distribution

* Diabetes prevalence ~11%.

### Predictor Patterns

* Age ↑ and BMI ↑ associated with diabetes
* Prevalence varies by sex and race

:::
:::

---

## EDA Figures

::: panel-tabset

### BMI by Diabetes Status

![](figs/bmi_by_diabetes.png){fig-align="center" width="65%"}

### Diabetes by Race/Ethnicity

![](figs/diabetes_by_race.png){fig-align="center" width="65%"}

:::

---

## Modeling Frameworks

::: {style="font-size: 0.75em"}
::: panel-tabset

### Overview

**Reference Groups:**

* Male (sex)
* Non-Hispanic White (race).

**Continuous Predictors:**

* Survey-weighted model: raw age and BMI
* Bayesian model: standardized age_c and bmi_c (1 SD increase)

### Survey-Weighted Logistic Regression

* Accounts for NHANES multistage sampling:
  * Strata: SDMVSTRA
  * Clusters: SDMVPSU
  * Weights: WTMEC2YR  
* Provides population-representative estimates.

### Bayesian Logistic Regression (brms)

* Weakly informative priors (Normal(0,2.5), t(3,0,10)).
* Incorporates NHANES exam weights (wt_norm).
* Produces posterior distributions and credible intervals for all parameters.

:::
:::

---

## Survey-Weighted Logistic Regression

::: {style="font-size: 0.75em"}

**Key Findings:**

* Age: odds ratio ~3.03
* BMI: odds ratio ~1.89
* Females: lower odds vs. males (OR ~0.53)
* Race disparities:

  * Mexican American: ~2.04x higher odds
  * Other Hispanic: ~1.59x
  * NH Black: ~1.67x
  * Other/Multi: ~2.33x

*Note: Age is modeled in its raw units from NHANES; the OR reflects the scale of the age variable used in the survey-weighted model.*

:::

---

## Define Model and Priors 

::: {style="font-size: 0.9em"}
::: panel-tabset

### Model Formula

`diabetes_dx | weights(wt_norm) ~ age_c + bmi_c + sex + race`

### Priors

* Coefficients: Normal(0, 2.5)
* Intercept: Student t(3, 0, 10)

### Prior Visualization

![](figs/prior_age_bmi.png){fig-align="center" width="75%"}

:::
:::

---

## Data Preparation: MICE Imputation

* Multiple Imputation by Chained Equations (MICE) used for missing BMI, age, sex, race.
* Generated **5 imputations**; adult_imp1 used for modeling.
* Outcome variable (diabetes_dx) was *not* imputed.
* Categorical vars: logistic or polytomous regression.
* Completed dataset: n = 5,592 adults with full predictor availability.

---

## Imputed Dataset

::: {style="font-size: 0.75em"}
::: panel-tabset

### Standardized Predictors

Variables standardized as z-scores:

* age_c
* bmi_c

### Distribution of Standardized Predictors

![](figs/dist_age_bmi.png){fig-align="center" width="75%"}

### Dataset Structure

![](figs/str_adult_imp1.png){fig-align="center" width="100%"}
:::
:::

---

## Fit the Bayesian Model

::: {style="font-size: 0.75em"}
::: panel-tabset

### Model Fit

* Model fit using `brm()` with:

  * bernoulli(link = "logit")
  * priors defined previously
  * 4 chains, 2000 iterations, adapt_delta = 0.95
* All four MCMC chains converged (R-hat ≈ 1.00).

### Extraction of Posterior Odd Ratios

`bayes_or` created by exponentiating fixed effects:

* OR
* 95% credible intervals (LCL, UCL)

### Outcome

![](figs/bayes_or.png){fig-align="center" width="75%"}

:::
:::

---

## Posterior Odds Ratios (Bayesian Model)

::: panel-tabset

### Summary
::: {style="font-size: 0.75em"}

Posterior odds ratios (ORs) derived from exponentiated fixed effects.

Credible intervals (CrI) quantify uncertainty around each effect.

Interpretation reflects change in odds for a 1 SD increase (age_c, bmi_c) or relative to reference groups.
:::

### OR Table

![](figs/bayes_or.png){fig-align="center" width="70%"}

:::

---

## Model Comparison: Survey-Weighted vs Bayesian 

Odds ratios (95% intervals) compared across both modeling frameworks.

::: panel-tabset

### Comparison Table

![](figs/model_comparison_or.png){width="80%"}

### Key Patterns

* Age and BMI show strong positive associations with diabetes.
* Female sex has lower odds relative to males.
* Non-White racial/ethnic groups have higher odds than White adults.
* All posteriors show unimodal, well-defined distributions with narrow credible intervals.

:::

---

## Bayesian Diagnostics & Model Fit

::: panel-tabset

### Convergence Indicators

![](figs/mcmc_diagnostics.png)

* R-hat ≈ 1.00 for all parameters → excellent convergence  
* Bulk / Tail ESS > 2,000 → stable posterior sampling  
* No divergences or mixing issues

### Trace Plots

![](figs/mcmc_trace.png){width="85%"}

* Chains overlap well  
* No drift or instability  
* Strong evidence of convergence

### Posterior Distributions

![](figs/mcmc_areas.png){width="85%"}

* Unimodal and well-centered  
* Age & BMI → positive associations  
* Female sex → protective effect

### Autocorrelation

![](figs/mcmc_acf.png){width="85%"}

* Rapid decay across all parameters  
* Indicates efficient sampling and chain independence

:::

---

## Posterior Predictive Checks 

::: panel-tabset

### Observed vs Replicated

![](figs/ppc_bars.png){width="80%"}

### Interpretation 

* Observed (`y`) and replicated (`y_rep`) outcome distributions align closely.
* Indicates that the Bayesian model accurately reproduces the empirical binary outcome structure.

::: 

---

## Posterior Predictive Checks (cont.)

::: panel-tabset

### Mean of Outcome

![](figs/ppc_mean.png){width="80%"}

### Standard Deviation

![](figs/ppc_sd.png){width="80%"}

### Interpretation

* Posterior replicated datasets match the observed mean and variability.
* Strong evidence of **good model calibration**.
* The Bayesian model captures both **central tendency** and **dispersion** of diabetes outcomes.

:::

---

## Prior vs. Posterior

::: panel-tabset

### Distributions

![](figs/prior_posterior.png){width="85%"}

* Posterior shifts strongly for **Age** and **BMI**, showing they are highly informed by data.
* Posterior is narrower than the prior → increased certainty.
* Sex shows more overlap → weaker evidence compared to age/BMI.

### Conclusion

* Model incorporates priors appropriately.
* Strong predictors show clear posterior learning.
* Weak predictors are regularized without distortion.

:::

---

## Model Fit and Calibration 

::: panel-tabset

### Calibration Plot

![](figs/pred_calibration.png){width="80%"}

* Compares **observed diabetes outcomes** to **model-predicted probabilities**.
* LOESS curve aligns closely with the diagonal → **good model calibration**.

### Diabetes Prevalence Comparison

![](figs/posterior_prevalence_density.png){width="80%"}

* Posterior predictive mean matches survey-weighted NHANES prevalence.

### Population vs Posterior Prevalence

![](figs/pop_vs_posterior_bar.png){width="80%"}

* Bayesian posterior prevalence overlaps with survey-weighted estimate.
* Confirms **strong agreement** and **no systematic bias**.

:::

---

## Internal Validation: Individual-Level Predictions

*Posterior Predictive Distribution for an Example Participant*

![](figs/posterior_density_participant1.png){width="80%"}

* Shows uncertainty in an individual's predicted diabetes probability.
* 95% credible interval (red dashed lines) highlights plausible risk range.
* Demonstrates how Bayesian models produce distributions—not point predictions.

---

## Posterior Predictions and Inverse Inference

*Inverse Prediction: BMI Needed for Target Diabetes Risk*

![](figs/inverse_prediction_bmi.png){width="80%"}

* Uses the posterior model to determine what BMI corresponds to a target diabetes probability.
* Example target probability: **0.30**.
* Posterior predictions show that age and race have a stronger influence on diabetes risk than BMI, although BMI still shows a positive association.
* The estimated BMI associated with a 30% predicted diabetes probability is approximately **18 kg/m²**.

---

## Comparison Across Models

### Odds Ratios: Survey-Weighted vs Bayesian

![](figs/results_comparison.png){width="80%"}

---

## Discussion and Limitations

::: panel-tabset

### Discussion

* Bayesian modeling provided full posterior distributions, offering richer uncertainty quantification than classical MLE.
* Posterior predictive checks showed that simulated diabetes prevalence closely matched the survey-weighted estimate, indicating excellent model calibration.

### Limitations

* Used a **single imputed dataset** rather than fully propagating imputation uncertainty → possible slight understatement of variance.
* NHANES examination weights were **normalized** rather than modeled with full design-based structure → may slightly impact SEs.
* Weakly informative priors (Normal(0,2.5), t(3,0,10)) were not tuned; alternatives could shift posterior widths or shrinkage.
* All diagnostics were excellent, but results apply specifically to NHANES **2013–2014** and may not generalize to other cycles or longitudinal contexts.
* No external validation or sensitivity analysis; individual-level predictions are **illustrative only**, not clinical.

:::

---

## Conclusion

* Bayesian and survey-weighted logistic regression frameworks yielded **consistent predictors**: advancing age, higher BMI, female sex (protective), and non-White race/ethnicity (higher risk).
* Bayesian results closely matched frequentist estimates while adding:

  * posterior uncertainty quantification
  * credible intervals
  * posterior predictive calibration
* Diagnostics confirmed strong model performance (R̂ ≈ 1.00, excellent ESS, Bayesian R² ≈ 0.13).
* Bayesian inference enhances transparency, interpretability, and reproducibility in complex survey modeling.
* Future work may incorporate hierarchical priors, combined NHANES cycles, or Bayesian model averaging to explore heterogeneity and trends.

---

## Thank You

### Questions?
\
\
Presented by:\
**Namita Mishra**\
**Autumn S. Wilcox**